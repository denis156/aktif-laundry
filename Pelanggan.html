<!-- Include semua sub-components -->
<?!= include('Pelanggan/CreatePelanggan') ?>
<?!= include('Pelanggan/EditPelanggan') ?>
<?!= include('Pelanggan/DeletePelanggan') ?>
<?!= include('Pelanggan/ListPelanggan') ?>

<div class="card">
  <div class="card-body">
    <h2 class="card-title text-lg md:text-2xl lg:text-3xl font-bold">
      Data Pelanggan
    </h2>
    <p class="text-sm opacity-70 mb-4">
      Kelola data pelanggan dan informasi kontak
    </p>
    <div class="space-y-4">
      <!-- Table Section with Pagination -->
      <div class="rounded-box border border-base-content/5 bg-base-100">
        <!-- Header: Button & Search & Filter -->
        <div
          class="p-4 border-b border-base-content/5 flex flex-col md:flex-row justify-between items-start md:items-center gap-4"
        >
          <button
            class="btn btn-xs md:btn-sm lg:btn-md btn-primary"
            onclick="modal_tambah_pelanggan.showModal()"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              class="h-5 w-5"
              viewBox="0 0 20 20"
              fill="currentColor"
            >
              <path
                fill-rule="evenodd"
                d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z"
                clip-rule="evenodd"
              />
            </svg>
            Pelanggan Baru
          </button>

          <div class="join w-full md:w-auto">
            <input
              id="search_pelanggan"
              class="input input-bordered input-xs md:input-sm lg:input-md join-item w-full md:w-64"
              placeholder="Cari Nama, No HP..."
              onkeyup="searchAndFilter()"
            />
            <select
              id="filter_status"
              class="select select-bordered select-xs md:select-sm lg:select-md join-item w-32 md:w-40"
              onchange="searchAndFilter()"
            >
              <option value="">Semua</option>
              <option value="Aktif">Aktif</option>
              <option value="Tidak Aktif">Tidak Aktif</option>
            </select>
            <button
              class="btn btn-xs md:btn-sm lg:btn-md join-item"
              onclick="clearSearchFilter()"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                class="h-4 w-4"
                viewBox="0 0 20 20"
                fill="currentColor"
              >
                <path
                  fill-rule="evenodd"
                  d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z"
                  clip-rule="evenodd"
                />
              </svg>
            </button>
          </div>
        </div>
        <!-- Table -->
        <div class="overflow-x-auto">
          <table class="table table-zebra table-sm">
            <thead>
              <tr>
                <th>ID Pelanggan</th>
                <th>Nama</th>
                <th>No. HP</th>
                <th>Email</th>
                <th>Total Transaksi</th>
                <th>Status</th>
                <th>Aksi</th>
              </tr>
            </thead>
            <tbody id="pelangganTableBody">
              <? if (pelangganData && pelangganData.length >
              0) { ?>
              <? for (var i = 0; i < pelangganData.length; i++) { ?>
              <tr>
                <td><span class="font-mono font-bold"><?= pelangganData[i].id ?></span></td>
                <td>
                  <div class="font-bold"><?= pelangganData[i].nama ?></div>
                  <div class="text-sm opacity-50">
                    <?= pelangganData[i].alamat || '-' ?>
                  </div>
                </td>
                <td><?= pelangganData[i].noHp ?></td>
                <td><?= pelangganData[i].email || '-' ?></td>
                <td>
                  <?= pelangganData[i].totalTransaksi ?>
                  kali
                </td>
                <td>
                  <? if (pelangganData[i].status === 'Aktif') { ?>
                  <span
                    class="badge badge-xs md:badge-sm lg:badge-md badge-success"
                    >Aktif</span
                  >
                  <? } else { ?>
                  <span
                    class="badge badge-xs md:badge-sm lg:badge-md badge-error truncate"
                    >Tidak Aktif</span
                  >
                  <? } ?>
                </td>
                <td>
                  <div class="flex gap-2">
                    <button
                      class="btn btn-info btn-sm text-info-content"
                      data-id="<?= pelangganData[i].id ?>"
                      data-nama="<?= pelangganData[i].nama ?>"
                      data-nohp="<?= pelangganData[i].noHp ?>"
                      data-alamat="<?= pelangganData[i].alamat || '' ?>"
                      data-email="<?= pelangganData[i].email || '' ?>"
                      data-tanggaldaftar="<?= Utilities.formatDate(new Date(pelangganData[i].tanggalDaftar), Session.getScriptTimeZone(), 'dd/MM/yyyy') ?>"
                      data-totaltransaksi="<?= pelangganData[i].totalTransaksi ?>"
                      data-status="<?= pelangganData[i].status ?>"
                      onclick="viewPelangganData(this)"
                    >
                      Detail
                    </button>
                    <button
                      class="btn btn-success btn-sm text-success-content"
                      data-id="<?= pelangganData[i].id ?>"
                      data-nama="<?= pelangganData[i].nama ?>"
                      data-nohp="<?= pelangganData[i].noHp ?>"
                      data-alamat="<?= pelangganData[i].alamat || '' ?>"
                      data-email="<?= pelangganData[i].email || '' ?>"
                      data-status="<?= pelangganData[i].status ?>"
                      onclick="editPelangganData(this)"
                    >
                      Edit
                    </button>
                    <button
                      class="btn btn-error btn-sm text-error-content"
                      data-id="<?= pelangganData[i].id ?>"
                      data-nama="<?= pelangganData[i].nama ?>"
                      onclick="deletePelangganConfirmData(this)"
                    >
                      Hapus
                    </button>
                  </div>
                </td>
              </tr>
              <? } ?>
              <? } else { ?>
              <tr>
                <td colspan="7" class="text-center">
                  Belum ada data pelanggan
                </td>
              </tr>
              <? } ?>
            </tbody>
          </table>
        </div>

        <!-- Pagination (Bottom) -->
        <div class="p-4 border-t border-base-content/5">
          <!-- Mobile Layout: Stack vertically -->
          <div class="flex flex-col gap-3 md:hidden">
            <!-- Row 1: Pagination Controls -->
            <div class="join justify-center">
              <button class="join-item btn btn-xs" onclick="goToPrevPage()">
                ‹
              </button>
              <button
                class="join-item btn btn-xs btn-active"
                id="page_info_mobile"
              >
                Page 1
              </button>
              <button class="join-item btn btn-xs" onclick="goToNextPage()">
                ›
              </button>
            </div>

            <!-- Row 2: Info Text -->
            <div class="text-sm text-center">
              Menampilkan <span id="showing_start_mobile">1</span> -
              <span id="showing_end_mobile">10</span> dari
              <span id="total_items_mobile">0</span> pelanggan
            </div>

            <!-- Row 3: Items per page -->
            <div class="flex justify-center">
              <select
                id="items_per_page_mobile"
                class="select select-bordered select-xs w-16"
                onchange="changeItemsPerPage()"
              >
                <option value="5">5</option>
                <option value="10" selected>10</option>
                <option value="25">25</option>
                <option value="50">50</option>
                <option value="100">100</option>
              </select>
            </div>
          </div>

          <!-- Desktop Layout: Grid with 3 columns -->
          <div class="hidden md:grid md:grid-cols-3 items-center gap-4">
            <!-- Start: Info -->
            <div class="text-sm text-left">
              Menampilkan <span id="showing_start">1</span> -
              <span id="showing_end">10</span> dari
              <span id="total_items">0</span> pelanggan
            </div>

            <!-- Center: Navigation Desktop (With Numbers) -->
            <div class="join justify-center" id="pagination_desktop">
              <!-- Will be populated by JavaScript -->
            </div>

            <!-- End: Items per page -->
            <div class="flex justify-end">
              <select
                id="items_per_page"
                class="select select-bordered select-sm w-20"
                onchange="changeItemsPerPage()"
              >
                <option value="5">5</option>
                <option value="10" selected>10</option>
                <option value="25">25</option>
                <option value="50">50</option>
                <option value="100">100</option>
              </select>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
