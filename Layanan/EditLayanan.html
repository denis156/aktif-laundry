<!-- ==================== MODAL EDIT LAYANAN ==================== -->
<dialog id="modal_edit_layanan" class="modal modal-bottom sm:modal-middle">
  <div class="modal-box">
    <h3 class="text-lg font-bold mb-4">Edit Layanan</h3>
    <form id="form_edit_layanan" class="space-y-4">
      <input type="hidden" id="edit_id">

      <div>
        <label class="label">
          <span class="label-text">Nama Layanan</span>
        </label>
        <input type="text" id="edit_nama" placeholder="Nama layanan" class="input input-bordered w-full" required />
      </div>

      <div>
        <label class="label">
          <span class="label-text">Harga per Kg</span>
        </label>
        <input type="number" id="edit_harga" placeholder="0" class="input input-bordered w-full" required min="1" />
      </div>

      <div>
        <label class="label">
          <span class="label-text">Durasi (Jam)</span>
        </label>
        <input type="number" id="edit_durasi" placeholder="0" class="input input-bordered w-full" required min="1" />
      </div>

      <div>
        <label class="label">
          <span class="label-text">Deskripsi</span>
        </label>
        <textarea id="edit_deskripsi" class="textarea textarea-bordered w-full" placeholder="Deskripsi layanan"></textarea>
      </div>

      <div>
        <label class="label">
          <span class="label-text">Status</span>
        </label>
        <select id="edit_status" class="select select-bordered w-full" required>
          <option value="">Pilih status</option>
          <option value="Aktif">Aktif</option>
          <option value="Tidak Aktif">Tidak Aktif</option>
        </select>
      </div>

      <div class="modal-action">
        <button type="button" class="btn" onclick="modal_edit_layanan.close()">Batal</button>
        <button type="submit" class="btn btn-primary">Simpan</button>
      </div>
    </form>
  </div>
</dialog>

<!-- ==================== SCRIPT EDIT LAYANAN ==================== -->
<script>
  /**
   * Edit Layanan Logic
   */

  // Edit Layanan - Open modal with data
  window.editLayananData = function(btn) {
    var data = btn.dataset;
    document.getElementById('edit_id').value = data.id;
    document.getElementById('edit_nama').value = data.nama;
    document.getElementById('edit_harga').value = data.harga;
    document.getElementById('edit_durasi').value = data.durasi;
    document.getElementById('edit_deskripsi').value = data.deskripsi || '';
    document.getElementById('edit_status').value = data.status;

    modal_edit_layanan.showModal();
  };

  // Handle Form Edit Submit
  function handleEditLayananFormSubmit(e) {
    e.preventDefault();
    e.stopPropagation();

    var data = {
      nama: document.getElementById('edit_nama').value,
      harga: document.getElementById('edit_harga').value,
      durasi: document.getElementById('edit_durasi').value,
      deskripsi: document.getElementById('edit_deskripsi').value,
      status: document.getElementById('edit_status').value
    };

    var id = document.getElementById('edit_id').value;

    google.script.run
      .withSuccessHandler(function(result) {
        if (result.success) {
          showSuccessAlert('Berhasil!', result.message);
          modal_edit_layanan.close();
          navigateTo('Layanan');
        } else {
          showErrorAlert('Gagal!', result.message);
        }
      })
      .withFailureHandler(function(error) {
        showErrorAlert('Kesalahan Server', error.message);
      })
      .editLayanan(id, data);

    return false;
  }

  // Attach form submit handler
  ;(function() {
    setTimeout(function() {
      var formEdit = document.getElementById('form_edit_layanan');
      if (formEdit) {
        formEdit.onsubmit = handleEditLayananFormSubmit;
      }
    }, 100);
  })();
</script>
